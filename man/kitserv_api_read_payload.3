.Dd December 11, 2023
.Dt kitserv_api_read_payload 3
.Nm kitserv_api_read_payload(3)
.Sh SYNOPSIS
.Pp
.Lb kitserv
.Pp
.In kitserv.h
.Pp
.Ft int
.Fn kitserv_api_read_payload "struct kitserv_client*" "char* buf" "int nbytes"
.Sh DESCRIPTION
The
.Sy kitserv_api_read_payload()
function reads up to
.Em nbytes
from the client, as payload data. This data is written into
.Em buf , No which should be at least
.Em nbytes
long.
.Pp
Once the data is read by this function, it is considered "consumed" and will
.Em not
be returned in any future calls. The endpoint is responsible for making sure that
it does not read more than content-length bytes.
.Pp
Because Kitserv uses nonblocking sockets, it is possible that this request
blocks. If this happens, the endpoint should return from the handler function
and give control back to Kitserv. So long as the HTTP response status is not
set (it is 
.Em HTTP_X_RESP_STATUS_UNSET ) No then Kitserv will re-call the handler when more
data is available. Endpoints may make use of
.Sy kitserv_api_save_state()
to keep track of information between calls.
.Pp
If the read suffers an error besides blocking, Kitserv will hang up on the
client. Take this opportunity to close any resources in use by the endpoint
before returning.
.Sh RETURN VALUE
.No On success, this function returns the actual number of bytes read ( Em nbytes
or fewer). On failure, this function returns -1, setting errno and possibly
setting the response status to
.Em HTTP_X_HANGUP . No
.Sh ERRORS
This function shall fail if:
.Bl -tag -width Ds
.It Sy EAGAIN / EWOULDBLOCK
The underlying read blocked because not enough data is available.
.El
.Pp
This function may also fail for any other reason
.Sy read(2)
might fail. If this occurs, the response status will be set to
.Em HTTP_X_HANGUP . No
.Sh COPYRIGHT
.Pp
Copyright (c) 2023 Jmcgee1125.
.Pp
Kitserv is licensed under the GNU Affero GPL v3. You are free to redistribute
and modify this code as you see fit, provided that you make the source code
freely available under these terms.
